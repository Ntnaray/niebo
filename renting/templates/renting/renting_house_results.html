{% extends 'users/base.html' %}
{% block body %}
<div>
	<!-- {{place}} -->
	<div id='map' style='width: 600px; height: 500px;'></div>
	<!-- <span id='cord'>{{cord}}</span> -->

	<div>
		{{house}}
	</div>
	<script>
	// console.log(cord);
	var houses = {{ house|safe }};
	// widget.init(houses);
	// console.log(houses);
	$(function(){
		// var cord = document.getElementById('cord').innerHTML;
		var cord = '{{cord}}';
		// console.log(cord);
		mapboxgl.accessToken = 'pk.eyJ1IjoiaXZhcmR1IiwiYSI6ImNrYm80c2E5NjFnemcycXM0YXE3cTZmaWwifQ.RUzXxKHAH_vuUSs0hc4t7g';
		var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/streets-v11',
		// center:[76.49, 11.83],
		center:[20.977185,52.234062],
		zoom:3
		});

		// http://maps.google.com/?q=Nowoursynowska+145A%2CWarsaw

		// var geocoder = new MapboxGeocoder({
		// 	accessToken:mapboxgl.accessToken,
		// 	mapboxgl:mapboxgl
		// })
		// document.getElementById('geocoder').appendChild(geocoder.onAdd(map));
		// geocoder.addTo('#geocoder');

		// map.on('load', function(){
		// // console.log(cord);
		// var lnglt = cord.split(',')
		// var lng = parseFloat(lnglt[0]);
		// var lt = parseFloat(lnglt[1]);
		// map.jumpTo({center:[lng, lt],zoom:10});
		// });

		// var houses_json = JSON.parse('{{house}}');
		
		// {{house}}
		// var houses = houses_json.content;
		console.log(typeof(houses));
		var rent_house = JSON.parse(houses);
		console.log(typeof(rent_house))
		rent_house.features.forEach(function(house, i){
			house.properties.id=i;
		});
		// console.log(houses)

		map.on('load', function (e) {
		  /* Add the data to your map as a layer */
		map.addLayer({
		    "id": "locations",
		    "type": "symbol",
		    /* Add a GeoJSON source containing place coordinates and information. */
		    "source": {
		      "type": "geojson",
		      "data": houses
		    },
		    "layout": {
		      "icon-image": "restaurant-15",
		      "icon-allow-overlap": true,
		    }
		  });
		});
	});	
</script>
</div>
{% endblock %}
